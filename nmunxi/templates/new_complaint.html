{% extends "base.html" %}

{% block title %}File New Complaint{% endblock %}

{% block content %}
<h1><i class="fas fa-plus-circle"></i> File New Complaint</h1>

<form method="POST" action="{{ url_for('new_complaint') }}" enctype="multipart/form-data" class="card">
    <div class="form-group">
        <label>Complaint Title*</label>
        <input type="text" name="title" class="form-control" required placeholder="e.g., Pothole on Main Road">
    </div>
    
    <div class="form-group">
        <label>Category*</label>
        <select name="category" class="form-control" required>
            <option value="">Select Category</option>
            <option value="Road">Road & Infrastructure</option>
            <option value="Water">Water Supply</option>
            <option value="Electricity">Electricity</option>
            <option value="Sanitation">Sanitation & Garbage</option>
            <option value="Other">Other Issues</option>
        </select>
    </div>
    
    <div class="form-group">
        <label>Description*</label>
        <textarea name="description" class="form-control" rows="5" required 
                  placeholder="Describe the issue in detail..."></textarea>
    </div>
    
    <div class="form-group">
        <label>Upload Photo (Optional)</label>
        <input type="file" name="image" class="form-control" accept="image/*" onchange="previewImage(this)">
        
        <div id="imagePreviewContainer" style="margin-top: 10px; display: none;">
            <img id="imagePreview" style="max-width: 300px; border-radius: 5px;">
        </div>
    </div>
    
    <div class="form-group">
        <label>Location</label>
        <button type="button" class="btn" onclick="getLocation()" style="margin-bottom: 10px;">
            <i class="fas fa-location-arrow"></i> Get Current Location
        </button>
        
        <input type="hidden" id="latitude" name="latitude">
        <input type="hidden" id="longitude" name="longitude">
        
        <input type="text" name="address" class="form-control" placeholder="Enter address or landmark">
    </div>
    
    <div style="margin-top: 20px;">
        <button type="submit" class="btn" style="font-size: 1.1em;">
            <i class="fas fa-paper-plane"></i> Submit Complaint
        </button>
        <a href="{{ url_for('user_dashboard') }}" class="btn" style="background: var(--gray-color);">
            Cancel
        </a>
    </div>
</form>

<script>
function previewImage(input) {
    const container = document.getElementById('imagePreviewContainer');
    const preview = document.getElementById('imagePreview');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            container.style.display = 'block';
        }
        reader.readAsDataURL(input.files[0]);
    } else {
        container.style.display = 'none';
    }
}
</script>
{% endblock %}